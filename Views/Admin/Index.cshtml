@model VideoLibrary.Models.AdminDashboardViewModel

@{
    ViewData["Title"] = "Admin Dashboard";
}

<div class="d-flex justify-content-between align-items-center mb-4">
    <h1>Admin Dashboard</h1>
    <div>
        <a href="@Url.Action("Statistics")" class="btn btn-outline-info">Statistics</a>
        <a href="@Url.Action("RecentVideos")" class="btn btn-outline-info">Recent Videos</a>
        <a href="@Url.Action("Index", "Database")" class="btn btn-outline-info">Database Queries</a>
    </div>
</div>

@if (TempData["SuccessMessage"] != null)
{
    <div class="alert alert-success alert-dismissible fade show">
        <i class="bi bi-check-circle"></i> @TempData["SuccessMessage"]
        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
    </div>
}

<!-- Stats Overview -->
<div class="row mb-4">
    <div class="col-md-2">
        <div class="card text-center">
            <div class="card-body">
                <h5 class="card-title">Videos</h5>
                <h2 class="text-primary">@Model.TotalVideos</h2>
            </div>
        </div>
    </div>
    <div class="col-md-2">
        <div class="card text-center">
            <div class="card-body">
                <h5 class="card-title">Galleries</h5>
                <h2 class="text-success">@Model.TotalGalleries</h2>
            </div>
        </div>
    </div>
    <div class="col-md-2">
        <div class="card text-center">
            <div class="card-body">
                <h5 class="card-title">Total Tags</h5>
                <h2 class="text-info">@Model.TotalTags</h2>
            </div>
        </div>
    </div>
    <div class="col-md-2">
        <div class="card text-center">
            <div class="card-body">
                <h5 class="card-title">With Thumbnails</h5>
                <h2 class="text-warning">@Model.VideosWithThumbnails</h2>
                <small class="text-muted">(@Model.ThumbnailProgress.ToString("F1")%)</small>
            </div>
        </div>
    </div>
    <div class="col-md-2">
        <div class="card text-center">
            <div class="card-body">
                <h5 class="card-title">Analyzed</h5>
                <h2 class="text-secondary">@Model.VideosWithAnalysis</h2>
                <small class="text-muted">(@Model.AnalysisProgress.ToString("F1")%)</small>
            </div>
        </div>
    </div>
    <div class="col-md-2">
        <div class="card text-center">
            <div class="card-body">
                <h5 class="card-title">Tagged Galleries</h5>
                <h2 class="text-success">@Model.GalleriesWithTags</h2>
                <small class="text-muted">(@Model.GalleryTagProgress.ToString("F1")%)</small>
            </div>
        </div>
    </div>
</div>

<!-- Progress Bars (Add gallery progress to existing ones) -->
<div class="row mb-4">
    <div class="col-md-4">
        <div class="card">
            <div class="card-header">
                <h5 class="mb-0">Thumbnail Generation Progress</h5>
            </div>
            <div class="card-body">
                <div class="progress mb-2">
                    <div class="progress-bar bg-success" style="width: @Model.ThumbnailProgress%"></div>
                </div>
                <div class="d-flex justify-content-between">
                    <small>@Model.VideosWithThumbnails of @Model.TotalVideos completed</small>
                    <small>@Model.VideosWithoutThumbnails remaining</small>
                </div>
            </div>
        </div>
    </div>
    <div class="col-md-4">
        <div class="card">
            <div class="card-header">
                <h5 class="mb-0">Video Analysis Progress</h5>
            </div>
            <div class="card-body">
                <div class="progress mb-2">
                    <div class="progress-bar bg-warning" style="width: @Model.AnalysisProgress%"></div>
                </div>
                <div class="d-flex justify-content-between">
                    <small>@Model.VideosWithAnalysis of @Model.TotalVideos completed</small>
                    <small>@Model.VideosWithoutAnalysis remaining</small>
                </div>
            </div>
        </div>
    </div>
    <div class="col-md-4">
        <div class="card">
            <div class="card-header">
                <h5 class="mb-0">Gallery Tagging Progress</h5>
            </div>
            <div class="card-body">
                <div class="progress mb-2">
                    <div class="progress-bar bg-info" style="width: @Model.GalleryTagProgress%"></div>
                </div>
                <div class="d-flex justify-content-between">
                    <small>@Model.GalleriesWithTags of @Model.TotalGalleries tagged</small>
                    <small>@Model.GalleriesWithoutTags untagged</small>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Update the Manual Operations section to include gallery operations -->
<div class="row">
    <div class="col-12">
        <div class="card">
            <div class="card-header">
                <h5 class="mb-0">Manual Operations</h5>
            </div>
            <div class="card-body">
                <!-- Video Operations -->
                <h6 class="text-muted mb-3">Video Operations</h6>
                <div class="row mb-4">
                    <div class="col-md-6 col-lg-3 mb-3">
                        <div class="d-grid">
                            <form asp-action="ScanVideos" method="post" class="d-inline">
                                <button type="submit" class="btn btn-primary btn-lg">
                                    <i class="bi bi-search"></i><br>
                                    <small>Scan for Videos</small>
                                </button>
                            </form>
                        </div>
                        <small class="text-muted d-block mt-1">Search for new video files in the configured folder</small>
                    </div>

                    <div class="col-md-6 col-lg-3 mb-3">
                        <div class="d-grid">
                            <form asp-action="GenerateThumbnails" method="post" class="d-inline">
                                <button type="submit" class="btn btn-success btn-lg">
                                    <i class="bi bi-image"></i><br>
                                    <small>Generate Thumbnails</small>
                                </button>
                            </form>
                        </div>
                        <small class="text-muted d-block mt-1">Create thumbnails for videos that don't have them</small>
                    </div>

                    <div class="col-md-6 col-lg-3 mb-3">
                        <div class="d-grid">
                            <form asp-action="AnalyzeVideos" method="post" class="d-inline">
                                <button type="submit" class="btn btn-warning btn-lg">
                                    <i class="bi bi-analytics"></i><br>
                                    <small>Analyze Videos</small>
                                </button>
                            </form>
                        </div>
                        <small class="text-muted d-block mt-1">Extract metadata like duration, resolution, and codecs</small>
                    </div>

                    <div class="col-md-6 col-lg-3 mb-3">
                        <div class="d-grid">
                            <form asp-action="UpdateTagThumbnails" method="post" class="d-inline">
                                <button type="submit" class="btn btn-info btn-lg">
                                    <i class="bi bi-tags"></i><br>
                                    <small>Update Tag Thumbnails</small>
                                </button>
                            </form>
                        </div>
                        <small class="text-muted d-block mt-1">Assign thumbnails to tags from their videos</small>
                    </div>
                </div>

                <!-- Gallery Operations -->
                <h6 class="text-muted mb-3">Gallery Operations</h6>
                <div class="row mb-4">
                    <div class="col-md-6 col-lg-3 mb-3">
                        <div class="d-grid">
                            <form asp-action="ScanGalleries" method="post" class="d-inline">
                                <button type="submit" class="btn btn-outline-primary btn-lg">
                                    <i class="bi bi-images"></i><br>
                                    <small>Scan for Galleries</small>
                                </button>
                            </form>
                        </div>
                        <small class="text-muted d-block mt-1">Search for new gallery folders in the configured path</small>
                    </div>

                    <div class="col-md-6 col-lg-3 mb-3">
                        <div class="d-grid">
                            <form asp-action="ClearGalleryCache" method="post" class="d-inline">
                                <button type="submit" class="btn btn-outline-secondary btn-lg">
                                    <i class="bi bi-arrow-clockwise"></i><br>
                                    <small>Clear Gallery Cache</small>
                                </button>
                            </form>
                        </div>
                        <small class="text-muted d-block mt-1">Clear cached gallery information to refresh file lists</small>
                    </div>
                </div>

                <hr>

                <!-- Complete Operations -->
                <h6 class="text-muted mb-3">Complete Operations</h6>
                <div class="row">
                    <div class="col-md-6 text-center">
                        <form asp-action="RunAllTasks" method="post" class="d-inline">
                            <button type="submit" class="btn btn-danger btn-lg">
                                <i class="bi bi-play-circle"></i> Run Complete Video Maintenance
                            </button>
                        </form>
                        <div class="mt-2">
                            <small class="text-muted">Runs: Scan → Thumbnails → Analysis → Tag Thumbnails</small>
                        </div>
                    </div>
                    <div class="col-md-6 text-center">
                        <form asp-action="ScanGalleries" method="post" class="d-inline">
                            <button type="submit" class="btn btn-outline-danger btn-lg">
                                <i class="bi bi-images"></i> Scan All Galleries
                            </button>
                        </form>
                        <div class="mt-2">
                            <small class="text-muted">Discovers new gallery folders and refreshes cache</small>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Add loading states to buttons
        const forms = document.querySelectorAll('form[method="post"]');
        forms.forEach(form => {
            form.addEventListener('submit', function() {
                const button = this.querySelector('button[type="submit"]');
                const originalHtml = button.innerHTML;
                button.innerHTML = '<span class="spinner-border spinner-border-sm"></span> Running...';
                button.disabled = true;

                // Re-enable after a delay to prevent confusion
                setTimeout(() => {
                    button.innerHTML = originalHtml;
                    button.disabled = false;
                }, 3000);
            });
        });
    });
</script>